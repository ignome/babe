<%= render 'cpanel/shared/tabs_of_task' %>

<%= simple_form_for([:cpanel, Item.new], html:{ id: 'form' }) do %>
<table class="table" width="100%" cellpadding="0" cellspacing="0">
  <thead>
    <tr>
      <th width="30">
        <input type="checkbox" name="all" id="chkall">
      </th>
      <th width="64">小图</th>
      <th>商品名称</th>
      <th width="100">生成时间</th>
      <th width="100" >价格</th>
      <th width="120"></th>
    </tr>
  </thead>

  <tbody>
    <% @items.each do |o| %>
    <tr>
      <td >
        <input type="checkbox" id="chk<%= o.id %>" name="id[]" value="<%=o.id %>">
      </td>

      <td>
        <%= image_tag o.cover, size: '50x50' %>
      </td>
      <td><%=link_to o.title, o.url, target: '_blank' %></td>
      <td><%= o.created_at.strftime("%m-%d %H:%M:S")%></td>
      <td><%= o.price %></th>
      <td>
        <%= link_to '删除', cpanel_task_path(o.id), :method => :delete, :'data-confirm' => '确定要删除吗?', :class => "icon-remove" %>
        <a href="<%= o.url %>" class="download">下载</a>
      </td>
    </tr>
    <% end %>

    <tfoot>
      <td colspan="9">
        <div class="btn-group btn-group-xs">
          <button type="button" class="btn btn-danger" onclick="post('./tasks/remove');">删除选中</button>
          <button type="button" class="btn btn-success" onclick="post('./items/moveto');">下载选中</button>          
        </div>

        <%= will_paginate @items%>

      </td>
    </tfoot>
  </tbody>
</table>
<% end %>

<%= content_for :scripts do %>
<script type="text/javascript">
$(document).on('click', 'a.download', function(){
  var self = $(this);
  $.ajax({
    url : '/items/fetch',
    data : { 'url': self.attr('href'), 'save': 1},
    beforeSend : function(){
      self.removeClass('download');
    },
    success : function(){
      self.remove();
    }
  });
  return false;
});
</script>
<% end %>